<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Space War - Ïö∞Ï£º Ï†ÑÏüÅ</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.70.0/dist/phaser.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: 'Malgun Gothic', Arial, sans-serif;
        }
        #game-container {
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.7);
        }
    </style>
</head>
<body>
    <div id="game-container"></div>
    <script>
        // === Í≤åÏûÑ ÏÑ§Ï†ï ===
        const config = {
            type: Phaser.AUTO,
            width: 1200,
            height: 800,
            parent: 'game-container',
            backgroundColor: '#0a0a1a',
            physics: {
                default: 'arcade',
                arcade: {
                    gravity: { y: 0 },
                    debug: false
                }
            },
            scene: {
                preload: preload,
                create: create,
                update: update
            }
        };

        const game = new Phaser.Game(config);

        // === Ï†ÑÏó≠ Î≥ÄÏàò ===
        let player;
        let enemies;
        let bullets;
        let xpOrbs;
        let particles;
        
        let playerStats = {
            hp: 100,
            maxHp: 100,
            xp: 0,
            level: 1,
            xpToNext: 10
        };

        let weaponStats = {
            damage: 15,
            fireRate: 800,
            lastFired: 0,
            range: 400,
            projectileSpeed: 500,
            count: 1,
            pierce: 0
        };

        let gameStats = {
            kills: 0,
            time: 0,
            enemiesAlive: 0
        };

        let uiTexts = {};
        let upgradeContainer;
        let isPaused = false;
        let starfield;

        // === Preload ===
        function preload() {
            // Í∞ÑÎã®Ìïú Í∑∏ÎûòÌîΩ ÏÉùÏÑ± (ÎÇòÏ§ëÏóê Ïä§ÌîÑÎùºÏù¥Ìä∏Î°ú ÍµêÏ≤¥ Í∞ÄÎä•)
        }

        // === Create ===
        function create() {
            // Î∞∞Í≤Ω Î≥Ñ ÏÉùÏÑ±
            createStarfield(this);

            // ÌååÌã∞ÌÅ¥ ÏãúÏä§ÌÖú
            particles = this.add.particles(0, 0, 'white', {
                speed: { min: 50, max: 200 },
                scale: { start: 1, end: 0 },
                blendMode: 'ADD',
                lifespan: 500,
                active: false
            });

            // ÌîåÎ†àÏù¥Ïñ¥ ÏÉùÏÑ± (Ï§ëÏïô Í≥†Ï†ï)
            const centerX = config.width / 2;
            const centerY = config.height / 2;
            
            player = this.add.container(centerX, centerY);
            
            // ÌîåÎ†àÏù¥Ïñ¥ ÏÑ†Ï≤¥
            const shipBody = this.add.triangle(0, 0, 0, -20, -15, 20, 15, 20, 0x00ffff);
            const shipCore = this.add.circle(0, 0, 8, 0xffffff);
            const shipGlow = this.add.circle(0, 0, 15, 0x00ffff, 0.3);
            
            player.add([shipGlow, shipBody, shipCore]);
            this.physics.add.existing(player);
            player.body.setCircle(15);

            // ÌîåÎ†àÏù¥Ïñ¥ ÏóîÏßÑ Î∂àÍΩÉ Ïï†ÎãàÎ©îÏù¥ÏÖò
            this.tweens.add({
                targets: shipGlow,
                scale: { from: 1, to: 1.3 },
                alpha: { from: 0.3, to: 0.6 },
                duration: 500,
                yoyo: true,
                repeat: -1
            });

            // Í∑∏Î£π ÏÉùÏÑ±
            enemies = this.physics.add.group();
            bullets = this.physics.add.group();
            xpOrbs = this.physics.add.group();

            // Ï∂©Îèå ÏÑ§Ï†ï
            this.physics.add.overlap(bullets, enemies, hitEnemy, null, this);
            this.physics.add.overlap(player, xpOrbs, collectXP, null, this);
            this.physics.add.overlap(player, enemies, hitPlayer, null, this);

            // UI ÏÉùÏÑ±
            createUI(this);

            // Ï†Å Ïä§Ìè∞ ÌÉÄÏù¥Î®∏ (Ï†êÏ†ê Îπ†Î•¥Í≤å)
            this.time.addEvent({
                delay: 1500,
                callback: () => spawnEnemyWave(this),
                callbackScope: this,
                loop: true
            });

            // Í≤åÏûÑ ÏãúÍ∞Ñ ÌÉÄÏù¥Î®∏
            this.time.addEvent({
                delay: 1000,
                callback: () => {
                    gameStats.time++;
                    updateUI();
                },
                loop: true
            });
        }

        // === Update ===
        function update(time, delta) {
            if (isPaused) return;

            // ÏûêÎèô Î∞úÏÇ¨
            if (time > weaponStats.lastFired + weaponStats.fireRate) {
                fireWeapon(this, time);
            }

            // Ï†Å AI (ÌîåÎ†àÏù¥Ïñ¥ Ï∂îÏ†Å)
            enemies.children.entries.forEach(enemy => {
                this.physics.moveToObject(enemy, player, enemy.getData('speed'));
                
                // ÌöåÏ†Ñ Ïï†ÎãàÎ©îÏù¥ÏÖò
                enemy.rotation += 0.02;
            });

            // XP Ïò§Î∏å ÌîåÎ†àÏù¥Ïñ¥ Ï∂îÏ†Å
            xpOrbs.children.entries.forEach(orb => {
                const distance = Phaser.Math.Distance.Between(player.x, player.y, orb.x, orb.y);
                if (distance < 150) {
                    this.physics.moveToObject(orb, player, 300);
                    
                    // Ïò§Î∏å Î∞òÏßùÏûÑ
                    orb.setScale(1 + Math.sin(time * 0.01) * 0.2);
                }
            });

            // Î≥Ñ Ïä§ÌÅ¨Î°§ Ìö®Í≥º
            starfield.children.entries.forEach(star => {
                star.y += star.getData('speed');
                if (star.y > config.height) {
                    star.y = 0;
                    star.x = Phaser.Math.Between(0, config.width);
                }
            });
        }

        // === Î≥Ñ Î∞∞Í≤Ω ===
        function createStarfield(scene) {
            starfield = scene.add.group();
            for (let i = 0; i < 300; i++) {
                const x = Phaser.Math.Between(0, config.width);
                const y = Phaser.Math.Between(0, config.height);
                const size = Phaser.Math.Between(1, 3);
                const speed = size * 0.5;
                
                const star = scene.add.circle(x, y, size, 0xffffff, 0.6);
                star.setData('speed', speed);
                starfield.add(star);
            }
        }

        // === Î¨¥Í∏∞ Î∞úÏÇ¨ ===
        function fireWeapon(scene, time) {
            weaponStats.lastFired = time;

            // Í∞ÄÏû• Í∞ÄÍπåÏö¥ Ï†Å Ï∞æÍ∏∞
            let nearestEnemy = null;
            let minDistance = weaponStats.range;

            enemies.children.entries.forEach(enemy => {
                const distance = Phaser.Math.Distance.Between(player.x, player.y, enemy.x, enemy.y);
                if (distance < minDistance) {
                    minDistance = distance;
                    nearestEnemy = enemy;
                }
            });

            if (!nearestEnemy) return;

            // Î∞úÏÇ¨ ÏÇ¨Ïö¥Îìú Ìö®Í≥º (ÏãúÍ∞ÅÏ†Å)
            const muzzleFlash = scene.add.circle(player.x, player.y, 20, 0xffff00, 0.8);
            scene.tweens.add({
                targets: muzzleFlash,
                alpha: 0,
                scale: 2,
                duration: 100,
                onComplete: () => muzzleFlash.destroy()
            });

            // Îã§Ï§ë Î∞úÏÇ¨Ï≤¥
            const spreadAngle = weaponStats.count > 1 ? 0.3 : 0;
            
            for (let i = 0; i < weaponStats.count; i++) {
                const angle = Phaser.Math.Angle.Between(player.x, player.y, nearestEnemy.x, nearestEnemy.y);
                const offsetAngle = angle + (i - (weaponStats.count - 1) / 2) * spreadAngle;

                const bullet = scene.add.container(player.x, player.y);
                
                // Î∞úÏÇ¨Ï≤¥ ÎîîÏûêÏù∏
                const bulletCore = scene.add.circle(0, 0, 6, 0xffff00);
                const bulletGlow = scene.add.circle(0, 0, 10, 0xffff00, 0.5);
                const bulletTrail = scene.add.circle(0, 0, 8, 0xff9900, 0.3);
                
                bullet.add([bulletTrail, bulletGlow, bulletCore]);
                scene.physics.add.existing(bullet);
                bullet.body.setCircle(6);
                bullet.setData('pierce', weaponStats.pierce);
                bullet.setData('hits', 0);
                
                bullets.add(bullet);

                // Î∞úÏÇ¨Ï≤¥ Ïù¥Îèô
                scene.physics.velocityFromRotation(offsetAngle, weaponStats.projectileSpeed, bullet.body.velocity);
                bullet.rotation = offsetAngle;

                // Ìä∏Î†àÏùº Ìö®Í≥º
                scene.tweens.add({
                    targets: bulletGlow,
                    scale: { from: 1, to: 1.5 },
                    alpha: { from: 0.5, to: 0 },
                    duration: 200,
                    repeat: -1
                });

                // Î∞úÏÇ¨Ï≤¥ Ï†úÍ±∞ ÌÉÄÏù¥Î®∏
                scene.time.delayedCall(3000, () => {
                    if (bullet.active) bullet.destroy();
                });
            }
        }

        // === Ï†Å Ïä§Ìè∞ ===
        function spawnEnemyWave(scene) {
            const waveSize = 2 + Math.floor(gameStats.time / 30);
            
            for (let i = 0; i < waveSize; i++) {
                scene.time.delayedCall(i * 200, () => spawnEnemy(scene));
            }
        }

        function spawnEnemy(scene) {
            const side = Phaser.Math.Between(0, 3);
            let x, y;

            switch(side) {
                case 0: x = Phaser.Math.Between(0, config.width); y = -30; break;
                case 1: x = config.width + 30; y = Phaser.Math.Between(0, config.height); break;
                case 2: x = Phaser.Math.Between(0, config.width); y = config.height + 30; break;
                case 3: x = -30; y = Phaser.Math.Between(0, config.height); break;
            }

            // Ï†Å Ï¢ÖÎ•ò ÎûúÎç§
            const enemyType = Phaser.Math.Between(0, 2);
            let enemy;

            if (enemyType === 0) {
                // ÏùºÎ∞ò Ï†Å
                enemy = scene.add.container(x, y);
                const body = scene.add.star(0, 0, 5, 8, 15, 0xff3333);
                const core = scene.add.circle(0, 0, 6, 0xff0000);
                enemy.add([body, core]);
                enemy.setData('hp', 30);
                enemy.setData('maxHp', 30);
                enemy.setData('speed', 100);
                enemy.setData('damage', 10);
                enemy.setData('xpValue', 5);
            } else if (enemyType === 1) {
                // Îπ†Î•∏ Ï†Å
                enemy = scene.add.container(x, y);
                const body = scene.add.triangle(0, 0, 0, -10, -8, 10, 8, 10, 0xff66ff);
                const trail = scene.add.circle(0, 5, 5, 0xff66ff, 0.3);
                enemy.add([trail, body]);
                enemy.setData('hp', 15);
                enemy.setData('maxHp', 15);
                enemy.setData('speed', 180);
                enemy.setData('damage', 8);
                enemy.setData('xpValue', 8);
            } else {
                // ÌÉ±ÌÅ¨ Ï†Å
                enemy = scene.add.container(x, y);
                const body = scene.add.circle(0, 0, 15, 0xff8800);
                const armor = scene.add.circle(0, 0, 12, 0x666666);
                enemy.add([body, armor]);
                enemy.setData('hp', 80);
                enemy.setData('maxHp', 80);
                enemy.setData('speed', 60);
                enemy.setData('damage', 20);
                enemy.setData('xpValue', 12);
            }

            scene.physics.add.existing(enemy);
            enemy.body.setCircle(15);
            enemies.add(enemy);
            gameStats.enemiesAlive++;
        }

        // === Ï∂©Îèå Ï≤òÎ¶¨ ===
        function hitEnemy(bullet, enemy) {
            const hp = enemy.getData('hp') - weaponStats.damage;
            enemy.setData('hp', hp);

            // ÌîºÍ≤© Ìö®Í≥º
            this.tweens.add({
                targets: enemy,
                alpha: 0.3,
                duration: 50,
                yoyo: true
            });

            // Î∞úÏÇ¨Ï≤¥ Í¥ÄÌÜµ Ï≤¥ÌÅ¨
            const hits = bullet.getData('hits') + 1;
            bullet.setData('hits', hits);
            
            if (hits > bullet.getData('pierce')) {
                bullet.destroy();
            }

            if (hp <= 0) {
                // Ìè≠Î∞ú Ìö®Í≥º
                const explosion = this.add.circle(enemy.x, enemy.y, 30, 0xff6600, 0.8);
                this.tweens.add({
                    targets: explosion,
                    scale: 3,
                    alpha: 0,
                    duration: 300,
                    onComplete: () => explosion.destroy()
                });

                enemy.destroy();
                gameStats.kills++;
                gameStats.enemiesAlive--;
                
                dropXP(this, enemy.x, enemy.y, enemy.getData('xpValue'));
                updateUI();
            }
        }

        function hitPlayer(player, enemy) {
            enemy.destroy();
            gameStats.enemiesAlive--;
            
            playerStats.hp -= enemy.getData('damage');
            
            // ÌîåÎ†àÏù¥Ïñ¥ ÌîºÍ≤© Ìö®Í≥º
            this.cameras.main.shake(200, 0.01);
            
            const damageFlash = this.add.rectangle(config.width/2, config.height/2, 
                config.width, config.height, 0xff0000, 0.3);
            this.tweens.add({
                targets: damageFlash,
                alpha: 0,
                duration: 200,
                onComplete: () => damageFlash.destroy()
            });

            updateUI();

            if (playerStats.hp <= 0) {
                gameOver(this);
            }
        }

        function dropXP(scene, x, y, value) {
            const orb = scene.add.container(x, y);
            
            const glow = scene.add.circle(0, 0, 10, 0x00ff00, 0.5);
            const core = scene.add.circle(0, 0, 6, 0x00ff00);
            
            orb.add([glow, core]);
            scene.physics.add.existing(orb);
            orb.body.setCircle(8);
            xpOrbs.add(orb);
            orb.setData('value', value);

            // Î∞òÏßùÏûÑ Ìö®Í≥º
            scene.tweens.add({
                targets: glow,
                scale: { from: 1, to: 1.5 },
                alpha: { from: 0.5, to: 0.2 },
                duration: 500,
                yoyo: true,
                repeat: -1
            });
        }

        function collectXP(player, orb) {
            // ÏàòÏßë Ìö®Í≥º
            this.tweens.add({
                targets: orb,
                scale: 2,
                alpha: 0,
                duration: 150,
                onComplete: () => {
                    orb.destroy();
                }
            });

            playerStats.xp += orb.getData('value');

            if (playerStats.xp >= playerStats.xpToNext) {
                levelUp(this);
            }

            updateUI();
        }

        // === Î†àÎ≤®ÏóÖ ===
        function levelUp(scene) {
            playerStats.level++;
            playerStats.xp -= playerStats.xpToNext;
            playerStats.xpToNext = Math.floor(playerStats.xpToNext * 1.4);

            isPaused = true;
            showUpgradeMenu(scene);
        }

        function showUpgradeMenu(scene) {
            const centerX = config.width / 2;
            const centerY = config.height / 2;

            upgradeContainer = scene.add.container(0, 0);

            // Î∞∞Í≤Ω
            const bg = scene.add.rectangle(centerX, centerY, 900, 600, 0x000000, 0.95);
            const border = scene.add.rectangle(centerX, centerY, 900, 600);
            border.setStrokeStyle(4, 0x00ffff);

            const title = scene.add.text(centerX, centerY - 250, `üéâ Î†àÎ≤® ${playerStats.level} Îã¨ÏÑ±! üéâ`, {
                fontSize: '48px',
                fill: '#00ffff',
                fontStyle: 'bold',
                stroke: '#000000',
                strokeThickness: 4
            }).setOrigin(0.5);

            const subtitle = scene.add.text(centerX, centerY - 200, 'ÏóÖÍ∑∏Î†àÏù¥ÎìúÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî', {
                fontSize: '24px',
                fill: '#ffffff'
            }).setOrigin(0.5);

            upgradeContainer.add([bg, border, title, subtitle]);

            // ÏóÖÍ∑∏Î†àÏù¥Îìú ÏòµÏÖò
            const upgrades = [
                { 
                    name: '‚ö° ÌôîÎ†• Ï¶ùÍ∞Ä', 
                    desc: 'Í≥µÍ≤©Î†• +10', 
                    icon: 'üí•',
                    action: () => { weaponStats.damage += 10; } 
                },
                { 
                    name: 'üî´ Ïó∞ÏÇ¨Î†• Ï¶ùÍ∞Ä', 
                    desc: 'Î∞úÏÇ¨ ÏÜçÎèÑ +25%', 
                    icon: '‚ö°',
                    action: () => { weaponStats.fireRate *= 0.75; } 
                },
                { 
                    name: '‚ù§Ô∏è Ï≤¥Î†• ÌöåÎ≥µ', 
                    desc: 'HP +40 & ÏµúÎåÄHP +20', 
                    icon: 'üíö',
                    action: () => { 
                        playerStats.maxHp += 20;
                        playerStats.hp = Math.min(playerStats.hp + 40, playerStats.maxHp); 
                    } 
                },
                { 
                    name: 'üéØ ÏÇ¨Í±∞Î¶¨ Ï¶ùÍ∞Ä', 
                    desc: 'ÏÇ¨Í±∞Î¶¨ +30%', 
                    icon: 'üî≠',
                    action: () => { weaponStats.range *= 1.3; } 
                },
                { 
                    name: 'üí´ Î©ÄÌã∞ÏÉ∑', 
                    desc: 'Ìà¨ÏÇ¨Ï≤¥ +1', 
                    icon: '‚ú®',
                    action: () => { weaponStats.count++; } 
                },
                { 
                    name: 'üõ°Ô∏è Í¥ÄÌÜµ', 
                    desc: 'Ï†Å Í¥ÄÌÜµ +1', 
                    icon: '‚öîÔ∏è',
                    action: () => { weaponStats.pierce++; } 
                },
                { 
                    name: 'üöÄ Ìà¨ÏÇ¨Ï≤¥ ÏÜçÎèÑ', 
                    desc: 'Î∞úÏÇ¨Ï≤¥ ÏÜçÎèÑ +25%', 
                    icon: 'üí®',
                    action: () => { weaponStats.projectileSpeed *= 1.25; } 
                }
            ];

            // ÎûúÎç§ 3Í∞ú ÏÑ†ÌÉù
            const selected = Phaser.Utils.Array.Shuffle(upgrades).slice(0, 3);
            
            selected.forEach((upgrade, i) => {
                const x = centerX - 250 + i * 250;
                const y = centerY - 50;
                
                const card = scene.add.rectangle(x, y, 220, 280, 0x1a1a2e);
                const cardBorder = scene.add.rectangle(x, y, 220, 280);
                cardBorder.setStrokeStyle(3, 0x00ffff);
                
                card.setInteractive({ useHandCursor: true })
                    .on('pointerover', () => {
                        card.setFillStyle(0x2a2a4e);
                        cardBorder.setStrokeStyle(4, 0x00ffff);
                        scene.tweens.add({
                            targets: card,
                            scaleX: 1.05,
                            scaleY: 1.05,
                            duration: 150
                        });
                    })
                    .on('pointerout', () => {
                        card.setFillStyle(0x1a1a2e);
                        cardBorder.setStrokeStyle(3, 0x00ffff);
                        scene.tweens.add({
                            targets: card,
                            scaleX: 1,
                            scaleY: 1,
                            duration: 150
                        });
                    })
                    .on('pointerdown', () => {
                        upgrade.action();
                        upgradeContainer.destroy();
                        isPaused = false;
                        updateUI();
                        
                        // Î†àÎ≤®ÏóÖ Ìö®Í≥º
                        const flash = scene.add.circle(config.width/2, config.height/2, 500, 0x00ffff, 0.5);
                        scene.tweens.add({
                            targets: flash,
                            scale: 3,
                            alpha: 0,
                            duration: 500,
                            onComplete: () => flash.destroy()
                        });
                    });

                const iconText = scene.add.text(x, y - 80, upgrade.icon, {
                    fontSize: '64px'
                }).setOrigin(0.5);

                const nameText = scene.add.text(x, y, upgrade.name, {
                    fontSize: '20px',
                    fill: '#ffffff',
                    fontStyle: 'bold',
                    align: 'center',
                    wordWrap: { width: 200 }
                }).setOrigin(0.5);

                const descText = scene.add.text(x, y + 50, upgrade.desc, {
                    fontSize: '16px',
                    fill: '#aaaaaa',
                    align: 'center'
                }).setOrigin(0.5);

                upgradeContainer.add([card, cardBorder, iconText, nameText, descText]);
            });

            upgradeContainer.setDepth(1000);
        }

        // === UI ===
        function createUI(scene) {
            // HP Î∞î
            const hpBarBg = scene.add.rectangle(20, 30, 250, 30, 0x333333).setOrigin(0, 0.5);
            const hpBarFill = scene.add.rectangle(22, 30, 246, 26, 0x00ff00).setOrigin(0, 0.5);
            const hpText = scene.add.text(145, 30, '', { 
                fontSize: '18px', 
                fill: '#ffffff',
                fontStyle: 'bold',
                stroke: '#000000',
                strokeThickness: 3
            }).setOrigin(0.5);

            // XP Î∞î
            const xpBarBg = scene.add.rectangle(20, 70, 250, 20, 0x333333).setOrigin(0, 0.5);
            const xpBarFill = scene.add.rectangle(22, 70, 246, 16, 0xffff00).setOrigin(0, 0.5);
            const xpText = scene.add.text(145, 70, '', { 
                fontSize: '14px', 
                fill: '#ffffff',
                stroke: '#000000',
                strokeThickness: 2
            }).setOrigin(0.5);

            // Ï†ïÎ≥¥ ÌÖçÏä§Ìä∏
            const levelText = scene.add.text(20, 100, '', { 
                fontSize: '20px', 
                fill: '#00ffff',
                fontStyle: 'bold',
                stroke: '#000000',
                strokeThickness: 3
            });
            const killsText = scene.add.text(20, 130, '', { 
                fontSize: '18px', 
                fill: '#ffff00',
                stroke: '#000000',
                strokeThickness: 2
            });
            const timeText = scene.add.text(config.width - 20, 30, '', { 
                fontSize: '24px', 
                fill: '#ffffff',
                fontStyle: 'bold',
                stroke: '#000000',
                strokeThickness: 3
            }).setOrigin(1, 0.5);

            uiTexts = {
                hpBarFill,
                hpText,
                xpBarFill,
                xpText,
                levelText,
                killsText,
                timeText
            };

            updateUI();
        }

        function updateUI() {
            if (!uiTexts.hpText) return;

            // HP Î∞î
            const hpPercent = playerStats.hp / playerStats.maxHp;
            uiTexts.hpBarFill.width = 246 * Math.max(0, hpPercent);
            
            // HP Î∞î ÏÉâÏÉÅ Î≥ÄÍ≤Ω
            if (hpPercent > 0.5) {
                uiTexts.hpBarFill.setFillStyle(0x00ff00);
            } else if (hpPercent > 0.25) {
                uiTexts.hpBarFill.setFillStyle(0xffaa00);
            } else {
                uiTexts.hpBarFill.setFillStyle(0xff0000);
            }
            
            uiTexts.hpText.setText(`HP: ${Math.max(0, Math.floor(playerStats.hp))} / ${playerStats.maxHp}`);

            // XP Î∞î
            const xpPercent = playerStats.xp / playerStats.xpToNext;
            uiTexts.xpBarFill.width = 246 * xpPercent;
            uiTexts.xpText.setText(`XP: ${playerStats.xp} / ${playerStats.xpToNext}`);

            // Ï†ïÎ≥¥ ÌÖçÏä§Ìä∏
            uiTexts.levelText.setText(`‚≠ê Î†àÎ≤®: ${playerStats.level}`);
            uiTexts.killsText.setText(`üíÄ ÌÇ¨: ${gameStats.kills}`);
            
            const minutes = Math.floor(gameStats.time / 60);
            const seconds = gameStats.time % 60;
            uiTexts.timeText.setText(`‚è±Ô∏è ${minutes}:${seconds.toString().padStart(2, '0')}`);
        }

        // === Í≤åÏûÑ Ïò§Î≤Ñ ===
        function gameOver(scene) {
            isPaused = true;
            
            const centerX = config.width / 2;
            const centerY = config.height / 2;

            const overlay = scene.add.rectangle(centerX, centerY, config.width, config.height, 0x000000, 0);
            scene.tweens.add({
                targets: overlay,
                alpha: 0.9,
                duration: 1000
            });

            scene.time.delayedCall(500, () => {
                const bg = scene.add.rectangle(centerX, centerY, 700, 500, 0x0a0a1a);
                const border = scene.add.rectangle(centerX, centerY, 700, 500);
                border.setStrokeStyle(5, 0xff0000);

                const title = scene.add.text(centerX, centerY - 180, 'üíÄ GAME OVER üíÄ', {
                    fontSize: '64px',
                    fill: '#ff0000',
                    fontStyle: 'bold',
                    stroke: '#000000',
                    strokeThickness: 6
                }).setOrigin(0.5);

                const stats = scene.add.text(centerX, centerY - 50, 
                    `‚è±Ô∏è ÏÉùÏ°¥ ÏãúÍ∞Ñ: ${Math.floor(gameStats.time / 60)}Î∂Ñ ${gameStats.time % 60}Ï¥à\n` +
                    `üíÄ Ï¥ù ÌÇ¨ Ïàò: ${gameStats.kills}\n` +
                    `‚≠ê ÏµúÏ¢Ö Î†àÎ≤®: ${playerStats.level}\n` +
                    `‚ö° ÏµúÏ¢Ö Í≥µÍ≤©Î†•: ${weaponStats.damage}`,
                    {
                        fontSize: '28px',
                        fill: '#ffffff',
                        align: 'center',
                        lineSpacing: 15
                    }
                ).setOrigin(0.5);

                const restartBtn = scene.add.rectangle(centerX, centerY + 150, 350, 70, 0x00aa00);
                const restartBorder = scene.add.rectangle(centerX, centerY + 150, 350, 70);
                restartBorder.setStrokeStyle(3, 0x00ff00);
                
                restartBtn.setInteractive({ useHandCursor: true })
                    .on('pointerover', () => {
                        restartBtn.setFillStyle(0x00ff00);
                        scene.tweens.add({
                            targets: restartBtn,
                            scaleX: 1.1,
                            scaleY: 1.1,
                            duration: 150
                        });
                    })
                    .on('pointerout', () => {
                        restartBtn.setFillStyle(0x00aa00);
                        scene.tweens.add({
                            targets: restartBtn,
                            scaleX: 1,
                            scaleY: 1,
                            duration: 150
                        });
                    })
                    .on('pointerdown', () => location.reload());

                const restartText = scene.add.text(centerX, centerY + 150, 'üîÑ Îã§Ïãú ÏãúÏûë', {
                    fontSize: '32px',
                    fill: '#ffffff',
                    fontStyle: 'bold'
                }).setOrigin(0.5);
            });
        }
    </script>
</body>
</html>