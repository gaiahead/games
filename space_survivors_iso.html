<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ïö∞Ï£º Ï†ÑÌï® ÏÑúÎ∞îÏù¥Î≤Ñ - ÏøºÌÑ∞Î∑∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Malgun Gothic', sans-serif;
            background: #000;
            color: #fff;
            overflow: hidden;
        }
        
        #gameCanvas {
            display: block;
            background: #1a1a2e;
            image-rendering: pixelated;
        }
        
        #ui {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            padding: 20px;
            pointer-events: none;
            z-index: 10;
        }
        
        .stat-bar {
            background: rgba(0,0,0,0.8);
            border: 2px solid #00ffff;
            border-radius: 10px;
            padding: 10px;
            display: inline-block;
            margin-right: 20px;
        }
        
        .stat-label {
            color: #00ffff;
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        .bar {
            width: 200px;
            height: 20px;
            background: #333;
            border-radius: 5px;
            overflow: hidden;
            border: 1px solid #666;
        }
        
        .bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff00, #00cc00);
            transition: width 0.3s;
        }
        
        .exp-bar .bar-fill {
            background: linear-gradient(90deg, #ffff00, #ff9900);
        }
        
        #levelUpModal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95);
            border: 3px solid #00ffff;
            border-radius: 15px;
            padding: 30px;
            display: none;
            z-index: 100;
            max-width: 800px;
            pointer-events: auto;
        }
        
        .upgrade-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 20px;
        }
        
        .upgrade-card {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border: 2px solid #00ffff;
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .upgrade-card:hover {
            transform: scale(1.05);
            border-color: #00ff00;
            box-shadow: 0 0 20px rgba(0,255,255,0.5);
        }
        
        .upgrade-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }
        
        .upgrade-name {
            color: #00ffff;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .upgrade-desc {
            color: #aaa;
            font-size: 14px;
        }
        
        .level-display {
            color: #ffff00;
            font-size: 16px;
            margin-top: 10px;
        }
        
        #gameOver {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95);
            border: 3px solid #ff0000;
            border-radius: 15px;
            padding: 40px;
            display: none;
            z-index: 100;
            text-align: center;
        }
        
        .btn {
            background: linear-gradient(135deg, #00ffff, #0099ff);
            border: none;
            color: #000;
            padding: 15px 30px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 10px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s;
        }
        
        .btn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(0,255,255,0.8);
        }
        
        #stats {
            position: fixed;
            top: 80px;
            left: 20px;
            background: rgba(0,0,0,0.8);
            border: 2px solid #00ffff;
            border-radius: 10px;
            padding: 15px;
            font-size: 14px;
            color: #0ff;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    
    <div id="ui">
        <div class="stat-bar">
            <div class="stat-label">HP: <span id="hpText">150/150</span></div>
            <div class="bar">
                <div class="bar-fill" id="hpBar" style="width: 100%"></div>
            </div>
        </div>
        <div class="stat-bar exp-bar">
            <div class="stat-label">Í≤ΩÌóòÏπò: <span id="expText">0/100</span></div>
            <div class="bar">
                <div class="bar-fill" id="expBar" style="width: 0%"></div>
            </div>
        </div>
    </div>
    
    <div id="stats">
        <div>Î†àÎ≤®: <span id="levelText">1</span></div>
        <div>ÏãúÍ∞Ñ: <span id="timeText">00:00</span></div>
        <div>Ï≤òÏπò: <span id="killText">0</span></div>
    </div>
    
    <div id="levelUpModal">
        <h2 style="color: #00ffff; text-align: center; margin-bottom: 20px;">‚¨ÜÔ∏è Î†àÎ≤® ÏóÖ! ÏóÖÍ∑∏Î†àÏù¥Îìú ÏÑ†ÌÉù</h2>
        <div class="upgrade-grid" id="upgradeOptions"></div>
    </div>
    
    <div id="gameOver">
        <h1 style="color: #ff0000; margin-bottom: 20px;">üí• Ï†ÑÌï® ÌååÍ¥¥!</h1>
        <div style="font-size: 24px; margin-bottom: 20px;">
            <div>ÏÉùÏ°¥ ÏãúÍ∞Ñ: <span id="finalTime" style="color: #ffff00;">00:00</span></div>
            <div>Ï¥ù Ï≤òÏπò: <span id="finalKills" style="color: #00ff00;">0</span></div>
            <div>ÏµúÏ¢Ö Î†àÎ≤®: <span id="finalLevel" style="color: #00ffff;">1</span></div>
        </div>
        <button class="btn" onclick="location.reload()">üîÑ Îã§Ïãú ÏãúÏûë</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        
        // ÏøºÌÑ∞Î∑∞ Î≥ÄÌôò (ÎîîÏïÑÎ∏îÎ°ú Ïä§ÌÉÄÏùº - 45ÎèÑ ÌöåÏ†Ñ + ÎπÑÏú®)
        const iso = {
            // 45ÎèÑ ÌöåÏ†Ñ + YÏ∂ï 0.5Î∞∞ ÏïïÏ∂ï
            toScreen: function(worldX, worldY) {
                // 45ÎèÑ ÌöåÏ†Ñ
                const rotX = (worldX - worldY) * 0.707; // cos(45) ‚âà 0.707
                const rotY = (worldX + worldY) * 0.707;
                // YÏ∂ï ÏïïÏ∂ï (ÏøºÌÑ∞Î∑∞ Ìö®Í≥º)
                return {
                    x: rotX,
                    y: rotY * 0.5
                };
            }
        };
        
        // Í≤åÏûÑ ÏÉÅÌÉú
        const game = {
            running: true,
            paused: false,
            time: 0,
            kills: 0,
            camera: {
                x: 0,
                y: 0
            },
            player: {
                x: 0,
                y: 0,
                size: 20,
                hp: 150,
                maxHp: 150,
                speed: 5,
                level: 1,
                exp: 0,
                expToNext: 100
            },
            weapons: [
                { type: 'laser', lastShot: 0 }
            ],
            enemies: [],
            projectiles: [],
            particles: [],
            tiles: []
        };
        
        // ÌÉÄÏùºÏùÄ ÎèôÏ†ÅÏúºÎ°ú Î†åÎçîÎßÅ (Î©îÎ™®Î¶¨ Ï†àÏïΩ)
        
        // ÌÇ§ ÏûÖÎ†•
        const keys = {};
        window.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
        window.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);
        
        // Î¨¥Í∏∞ Ï†ïÏùò
        const weaponTypes = {
            laser: {
                name: 'Î†àÏù¥Ï†Ä Ìè¨',
                icon: 'üî´',
                desc: 'Ï†ÑÎ∞©ÏúÑÎ°ú Î∞úÏÇ¨ÎêòÎäî Î†àÏù¥Ï†Ä',
                damage: 10,
                cooldown: 250,
                level: 1,
                maxLevel: 5,
                shoot: function(player) {
                    const baseCount = 2 + this.level;
                    for (let i = 0; i < baseCount; i++) {
                        const angle = Math.random() * Math.PI * 2;
                        const speed = 200;
                        game.projectiles.push({
                            x: player.x,
                            y: player.y,
                            z: 10,
                            vx: Math.cos(angle) * speed,
                            vy: Math.sin(angle) * speed,
                            size: 6,
                            damage: this.damage * (1 + this.level * 0.5),
                            color: '#00ffff',
                            type: 'laser'
                        });
                    }
                }
            },
            missile: {
                name: 'Ïú†ÎèÑ ÎØ∏ÏÇ¨Ïùº',
                icon: 'üöÄ',
                desc: 'Ï†ÅÏùÑ Ï∂îÏ†ÅÌïòÎäî ÎØ∏ÏÇ¨Ïùº',
                damage: 25,
                cooldown: 1000,
                level: 0,
                maxLevel: 5,
                shoot: function(player) {
                    if (game.enemies.length === 0) return;
                    const target = game.enemies[0];
                    game.projectiles.push({
                        x: player.x,
                        y: player.y,
                        z: 15,
                        vx: 0,
                        vy: 0,
                        size: 8,
                        damage: this.damage * (1 + this.level * 0.5),
                        color: '#ff6600',
                        type: 'missile',
                        target: target,
                        speed: 150
                    });
                }
            },
            plasma: {
                name: 'ÌîåÎùºÏ¶àÎßà Î≥º',
                icon: 'üí•',
                desc: 'Ìè≠Î∞úÌïòÎäî ÌîåÎùºÏ¶àÎßà',
                damage: 15,
                cooldown: 800,
                level: 0,
                maxLevel: 5,
                shoot: function(player) {
                    for (let i = 0; i < (1 + this.level); i++) {
                        const angle = (Math.PI * 2 / (1 + this.level)) * i;
                        game.projectiles.push({
                            x: player.x,
                            y: player.y,
                            z: 12,
                            vx: Math.cos(angle) * 180,
                            vy: Math.sin(angle) * 180,
                            size: 10,
                            damage: this.damage * (1 + this.level * 0.3),
                            color: '#ff00ff',
                            type: 'plasma',
                            radius: 50
                        });
                    }
                }
            },
            shield: {
                name: 'ÏóêÎÑàÏßÄ Ïã§Îìú',
                icon: 'üõ°Ô∏è',
                desc: 'ÏµúÎåÄ Ï≤¥Î†• +30',
                level: 0,
                maxLevel: 5,
                apply: function() {
                    game.player.maxHp += 30;
                    game.player.hp = Math.min(game.player.hp + 30, game.player.maxHp);
                }
            },
            speed: {
                name: 'Ï∂îÏßÑÍ∏∞ Í∞ïÌôî',
                icon: '‚ö°',
                desc: 'Ïù¥Îèô ÏÜçÎèÑ +1',
                level: 0,
                maxLevel: 5,
                apply: function() {
                    game.player.speed += 1;
                }
            },
            damage: {
                name: 'ÌôîÎ†• Ï¶ùÍ∞ï',
                icon: 'üí™',
                desc: 'Î™®Îì† Î¨¥Í∏∞ Îç∞ÎØ∏ÏßÄ +10%',
                level: 0,
                maxLevel: 10,
                apply: function() {}
            }
        };
        
        // ÏóÖÍ∑∏Î†àÏù¥Îìú ÏÑ†ÌÉù
        function showLevelUp() {
            game.paused = true;
            const modal = document.getElementById('levelUpModal');
            const options = document.getElementById('upgradeOptions');
            options.innerHTML = '';
            
            const available = Object.keys(weaponTypes).filter(k => {
                const w = weaponTypes[k];
                return !w.maxLevel || w.level < w.maxLevel;
            });
            
            const selected = [];
            while (selected.length < 3 && available.length > 0) {
                const idx = Math.floor(Math.random() * available.length);
                selected.push(available[idx]);
                available.splice(idx, 1);
            }
            
            selected.forEach(key => {
                const weapon = weaponTypes[key];
                const card = document.createElement('div');
                card.className = 'upgrade-card';
                card.innerHTML = `
                    <div class="upgrade-icon">${weapon.icon}</div>
                    <div class="upgrade-name">${weapon.name}</div>
                    <div class="upgrade-desc">${weapon.desc}</div>
                    <div class="level-display">Lv ${weapon.level} ‚Üí ${weapon.level + 1}</div>
                `;
                card.onclick = () => selectUpgrade(key);
                options.appendChild(card);
            });
            
            modal.style.display = 'block';
        }
        
        function selectUpgrade(key) {
            const weapon = weaponTypes[key];
            weapon.level++;
            
            if (weapon.shoot && !game.weapons.find(w => w.type === key)) {
                game.weapons.push({
                    type: key,
                    lastShot: 0
                });
            }
            
            if (weapon.apply) {
                weapon.apply();
            }
            
            document.getElementById('levelUpModal').style.display = 'none';
            game.paused = false;
        }
        
        // Ï†Å ÏÉùÏÑ±
        function spawnEnemy() {
            const angle = Math.random() * Math.PI * 2;
            const distance = 600;
            const x = game.player.x + Math.cos(angle) * distance;
            const y = game.player.y + Math.sin(angle) * distance;
            
            const difficulty = 1 + game.time / 60;
            
            game.enemies.push({
                x, y,
                size: 15,
                hp: 25 * difficulty,
                maxHp: 25 * difficulty,
                speed: 80 * Math.min(difficulty, 2),
                damage: 3,
                color: '#ff0000'
            });
        }
        
        // ÌååÌã∞ÌÅ¥ ÏÉùÏÑ±
        function createParticles(x, y, z, color, count = 10) {
            for (let i = 0; i < count; i++) {
                const angle = Math.random() * Math.PI * 2;
                const speed = Math.random() * 100 + 50;
                game.particles.push({
                    x, y, z: 10,
                    vx: Math.cos(angle) * speed,
                    vy: Math.sin(angle) * speed,
                    vz: Math.random() * 30 + 10,
                    size: Math.random() * 4 + 2,
                    color,
                    life: 30
                });
            }
        }
        
        // Í≤åÏûÑ Î£®ÌîÑ
        let lastTime = 0;
        let enemySpawnTimer = 0;
        
        function gameLoop(timestamp) {
            if (!game.running) return;
            
            const deltaTime = Math.min((timestamp - lastTime) / 1000, 0.1);
            lastTime = timestamp;
            
            if (!game.paused) {
                game.time += deltaTime;
                
                // ÌîåÎ†àÏù¥Ïñ¥ Ïù¥Îèô
                let dx = 0, dy = 0;
                if (keys['w'] || keys['arrowup']) dy -= 1;
                if (keys['s'] || keys['arrowdown']) dy += 1;
                if (keys['a'] || keys['arrowleft']) dx -= 1;
                if (keys['d'] || keys['arrowright']) dx += 1;
                
                if (dx !== 0 || dy !== 0) {
                    const len = Math.sqrt(dx*dx + dy*dy);
                    game.player.x += (dx/len) * game.player.speed * deltaTime * 100;
                    game.player.y += (dy/len) * game.player.speed * deltaTime * 100;
                }
                
                // Ïπ¥Î©îÎùº Ï∂îÏ†Å
                game.camera.x = game.player.x;
                game.camera.y = game.player.y;
                
                // Î¨¥Í∏∞ Î∞úÏÇ¨
                game.weapons.forEach(weapon => {
                    const weaponData = weaponTypes[weapon.type];
                    if (timestamp - weapon.lastShot > weaponData.cooldown) {
                        weaponData.shoot(game.player);
                        weapon.lastShot = timestamp;
                    }
                });
                
                // Î∞úÏÇ¨Ï≤¥ ÏóÖÎç∞Ïù¥Ìä∏
                game.projectiles = game.projectiles.filter(proj => {
                    if (proj.type === 'missile' && proj.target) {
                        const dx = proj.target.x - proj.x;
                        const dy = proj.target.y - proj.y;
                        const dist = Math.sqrt(dx*dx + dy*dy);
                        if (dist > 1) {
                            proj.vx = (dx/dist) * proj.speed;
                            proj.vy = (dy/dist) * proj.speed;
                        }
                    }
                    
                    proj.x += proj.vx * deltaTime;
                    proj.y += proj.vy * deltaTime;
                    
                    const distFromPlayer = Math.sqrt(
                        Math.pow(proj.x - game.player.x, 2) + 
                        Math.pow(proj.y - game.player.y, 2)
                    );
                    
                    return distFromPlayer < 1500;
                });
                
                // Ï†Å ÏóÖÎç∞Ïù¥Ìä∏
                game.enemies.forEach(enemy => {
                    const dx = game.player.x - enemy.x;
                    const dy = game.player.y - enemy.y;
                    const dist = Math.sqrt(dx*dx + dy*dy);
                    
                    if (dist > 1) {
                        enemy.x += (dx/dist) * enemy.speed * deltaTime;
                        enemy.y += (dy/dist) * enemy.speed * deltaTime;
                    }
                    
                    // ÌîåÎ†àÏù¥Ïñ¥ Ï∂©Îèå
                    if (dist < game.player.size + enemy.size) {
                        game.player.hp -= enemy.damage;
                        createParticles(enemy.x, enemy.y, enemy.z, '#ff0000', 5);
                        enemy.hp = 0;
                        
                        if (game.player.hp <= 0) {
                            gameOver();
                        }
                    }
                });
                
                // Î∞úÏÇ¨Ï≤¥-Ï†Å Ï∂©Îèå
                game.projectiles.forEach(proj => {
                    game.enemies.forEach(enemy => {
                        const dx = proj.x - enemy.x;
                        const dy = proj.y - enemy.y;
                        const dist = Math.sqrt(dx*dx + dy*dy);
                        
                        if (dist < proj.size + enemy.size) {
                            const totalDamage = proj.damage * (1 + (weaponTypes.damage.level * 0.1));
                            enemy.hp -= totalDamage;
                            createParticles(enemy.x, enemy.y, enemy.z, proj.color);
                            proj.x = -99999;
                            
                            if (enemy.hp <= 0) {
                                game.kills++;
                                game.player.exp += 10;
                                createParticles(enemy.x, enemy.y, enemy.z, '#ffff00', 20);
                                
                                if (game.player.exp >= game.player.expToNext) {
                                    game.player.level++;
                                    game.player.exp -= game.player.expToNext;
                                    game.player.expToNext = Math.floor(game.player.expToNext * 1.2);
                                    showLevelUp();
                                }
                            }
                        }
                    });
                });
                
                game.enemies = game.enemies.filter(e => e.hp > 0);
                
                // ÌååÌã∞ÌÅ¥ ÏóÖÎç∞Ïù¥Ìä∏
                game.particles = game.particles.filter(p => {
                    p.x += p.vx * deltaTime;
                    p.y += p.vy * deltaTime;
                    if (p.vz) {
                        p.z += p.vz * deltaTime;
                        p.vz -= 200 * deltaTime; // Ï§ëÎ†•
                        if (p.z < 0) {
                            p.z = 0;
                            p.vz = 0;
                        }
                    }
                    p.life--;
                    return p.life > 0;
                });
                
                // Ï†Å ÏÉùÏÑ±
                const spawnRate = Math.max(300 - game.time * 8, 100);
                enemySpawnTimer += deltaTime * 1000;
                if (enemySpawnTimer > spawnRate) {
                    spawnEnemy();
                    enemySpawnTimer = 0;
                }
            }
            
            // Î†åÎçîÎßÅ
            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Í∑∏Î¶¨Îìú Î†åÎçîÎßÅ (Îã®ÏàúÌôî)
            ctx.strokeStyle = 'rgba(255,255,255,0.1)';
            ctx.lineWidth = 1;
            const gridSize = 100;
            for (let gx = -10; gx < 10; gx++) {
                for (let gy = -10; gy < 10; gy++) {
                    const worldX = game.camera.x + gx * gridSize;
                    const worldY = game.camera.y + gy * gridSize;
                    const relX = worldX - game.camera.x;
                    const relY = worldY - game.camera.y;
                    const screenPos = iso.toScreen(relX, relY);
                    const x = canvas.width / 2 + screenPos.x;
                    const y = canvas.height / 2 + screenPos.y;
                    
                    // Îã§Ïù¥ÏïÑÎ™¨Îìú ÌÉÄÏùº
                    const tileSize = 50;
                    ctx.fillStyle = ((gx + gy) % 2 === 0) ? 'rgba(50,50,70,0.3)' : 'rgba(30,30,50,0.3)';
                    ctx.beginPath();
                    ctx.moveTo(x, y);
                    ctx.lineTo(x + tileSize, y + tileSize * 0.5);
                    ctx.lineTo(x, y + tileSize);
                    ctx.lineTo(x - tileSize, y + tileSize * 0.5);
                    ctx.closePath();
                    ctx.fill();
                    ctx.stroke();
                }
            }
            
            // Î™®Îì† Ïò§Î∏åÏ†ùÌä∏Î•º Y Ï¢åÌëú Í∏∞Ï§ÄÏúºÎ°ú ÏàòÏßë
            const renderList = [];
            
            // ÌååÌã∞ÌÅ¥
            game.particles.forEach(p => {
                const relX = p.x - game.camera.x;
                const relY = p.y - game.camera.y;
                const screenPos = iso.toScreen(relX, relY);
                renderList.push({
                    y: p.y,
                    render: () => {
                        const x = canvas.width / 2 + screenPos.x;
                        const y = canvas.height / 2 + screenPos.y - p.z * 0.5;
                        ctx.fillStyle = p.color;
                        ctx.globalAlpha = p.life / 30;
                        ctx.fillRect(x - p.size/2, y - p.size/2, p.size, p.size);
                        ctx.globalAlpha = 1;
                    }
                });
            });
            
            // Î∞úÏÇ¨Ï≤¥
            game.projectiles.forEach(proj => {
                const relX = proj.x - game.camera.x;
                const relY = proj.y - game.camera.y;
                const screenPos = iso.toScreen(relX, relY);
                renderList.push({
                    y: proj.y,
                    render: () => {
                        const x = canvas.width / 2 + screenPos.x;
                        const y = canvas.height / 2 + screenPos.y - proj.z * 0.5;
                        
                        ctx.fillStyle = proj.color;
                        ctx.shadowColor = proj.color;
                        ctx.shadowBlur = 10;
                        ctx.beginPath();
                        ctx.arc(x, y, proj.size, 0, Math.PI * 2);
                        ctx.fill();
                        ctx.shadowBlur = 0;
                    }
                });
            });
            
            // Ï†Å
            game.enemies.forEach(enemy => {
                const relX = enemy.x - game.camera.x;
                const relY = enemy.y - game.camera.y;
                const screenPos = iso.toScreen(relX, relY);
                renderList.push({
                    y: enemy.y,
                    render: () => {
                        const x = canvas.width / 2 + screenPos.x;
                        const y = canvas.height / 2 + screenPos.y;
                        
                        // Í∑∏Î¶ºÏûê
                        ctx.fillStyle = 'rgba(0,0,0,0.4)';
                        ctx.beginPath();
                        ctx.ellipse(x, y + 5, 15, 8, 0, 0, Math.PI * 2);
                        ctx.fill();
                        
                        // Ï†Å Î≥∏Ï≤¥
                        ctx.fillStyle = enemy.color;
                        ctx.strokeStyle = '#aa0000';
                        ctx.lineWidth = 2;
                        ctx.beginPath();
                        ctx.arc(x, y - 5, enemy.size, 0, Math.PI * 2);
                        ctx.fill();
                        ctx.stroke();
                        
                        // HP Î∞î
                        const ehpBarWidth = 30;
                        const ehpPercent = enemy.hp / enemy.maxHp;
                        ctx.fillStyle = '#333';
                        ctx.fillRect(x - ehpBarWidth/2, y - enemy.size - 15, ehpBarWidth, 3);
                        ctx.fillStyle = '#ff0000';
                        ctx.fillRect(x - ehpBarWidth/2, y - enemy.size - 15, ehpBarWidth * ehpPercent, 3);
                    }
                });
            });
            
            // ÌîåÎ†àÏù¥Ïñ¥
            renderList.push({
                y: game.player.y,
                render: () => {
                    const screenPos = iso.toScreen(0, 0);
                    const x = canvas.width / 2 + screenPos.x;
                    const y = canvas.height / 2 + screenPos.y;
                    
                    // Í∑∏Î¶ºÏûê
                    ctx.fillStyle = 'rgba(0,0,0,0.4)';
                    ctx.beginPath();
                    ctx.ellipse(x, y + 8, 20, 10, 0, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // ÌîåÎ†àÏù¥Ïñ¥ (Ïö∞Ï£ºÏÑ† Î™®Ïñë)
                    ctx.save();
                    ctx.translate(x, y - 5);
                    
                    // Î≥∏Ï≤¥
                    ctx.fillStyle = '#00ffff';
                    ctx.strokeStyle = '#00aaaa';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(0, -20);
                    ctx.lineTo(-15, 10);
                    ctx.lineTo(0, 5);
                    ctx.lineTo(15, 10);
                    ctx.closePath();
                    ctx.fill();
                    ctx.stroke();
                    
                    // ÏóîÏßÑ Î∂àÍΩÉ
                    ctx.fillStyle = '#ff6600';
                    ctx.beginPath();
                    ctx.arc(-5, 10, 3, 0, Math.PI * 2);
                    ctx.arc(5, 10, 3, 0, Math.PI * 2);
                    ctx.fill();
                    
                    ctx.restore();
                    
                    // HP Î∞î
                    const hpBarWidth = 40;
                    const hpPercent = game.player.hp / game.player.maxHp;
                    ctx.fillStyle = '#333';
                    ctx.fillRect(x - hpBarWidth/2, y - 35, hpBarWidth, 4);
                    ctx.fillStyle = hpPercent > 0.3 ? '#00ff00' : '#ff0000';
                    ctx.fillRect(x - hpBarWidth/2, y - 35, hpBarWidth * hpPercent, 4);
                }
            });
            
            // Y Ï¢åÌëú Í∏∞Ï§Ä Ï†ïÎ†¨
            renderList.sort((a, b) => a.y - b.y);
            
            // Î†åÎçîÎßÅ Ïã§Ìñâ
            renderList.forEach(obj => obj.render());
            
            // UI ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('hpText').textContent = `${Math.ceil(game.player.hp)}/${game.player.maxHp}`;
            document.getElementById('hpBar').style.width = (game.player.hp / game.player.maxHp * 100) + '%';
            document.getElementById('expText').textContent = `${game.player.exp}/${game.player.expToNext}`;
            document.getElementById('expBar').style.width = (game.player.exp / game.player.expToNext * 100) + '%';
            document.getElementById('levelText').textContent = game.player.level;
            document.getElementById('killText').textContent = game.kills;
            
            const minutes = Math.floor(game.time / 60);
            const seconds = Math.floor(game.time % 60);
            document.getElementById('timeText').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            requestAnimationFrame(gameLoop);
        }
        
        function gameOver() {
            game.running = false;
            const minutes = Math.floor(game.time / 60);
            const seconds = Math.floor(game.time % 60);
            document.getElementById('finalTime').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById('finalKills').textContent = game.kills;
            document.getElementById('finalLevel').textContent = game.player.level;
            document.getElementById('gameOver').style.display = 'block';
        }
        
        // ÏãúÏûë
        requestAnimationFrame(gameLoop);
        
        // ÌôîÎ©¥ ÌÅ¨Í∏∞ Ï°∞Ï†ï
        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });
    </script>
</body>
</html>
